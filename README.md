# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемы в приложении

Карточка

```
export interface ICard {
  _id: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  description?: string;
}
```

Структура, которая отвечает за множество карточек

```
export interface ICardData {
  cards: ICard[];
  preview: string | null;
}
```

Валидация форм

```
export interface IValidationForm {
  buttonError: boolean;
  addressError: string; 
  emailError: string; 
  phoneError: string; 
}
```

Корзина

```
export interface IBasket { 
  _id: string;
  total: number | null;
  items: ICard[];
}
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления — отвечает за отображение данных на странице, 
- слой данных — отвечает за хранение и изменение данных,
- презентер — отвечает за связь представления и данных.


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие


### Слой данных

#### Класс CardsData
Класс CardsData предназначен для управления карточками товаров. Он отвечает за хранение карточек, предоставление доступ к ним и инициацию событий при изменении данных. Класс предназначен для работы в контексте интерфейса.
- _cards: ICard[] - массив объектов карточек.
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- constructor(events: IEvents) — Инициализирует класс CardsData и принимает экземпляр класса EventEmitter для работы с событиями.
- getCard(cardID: string): ICard — Получение карточки по её уникальному идентификатору.
- а так же геттеры и сеттеры для _cards и _preview


### Слой модель

#### Класс ProductModel
Класс ProductModel отвечает за хранение и предоставление данных о товаре. Он реализует интерфейс ICard, что обеспечивает строгую типизацию данных о товаре.
- _product: ICard — Приватное свойство, хранящее данные о товаре, соответствующие интерфейсу ICard.

Методы:
- constructor(productData: ICard) — Конструктор класса. Принимает объект типа ICard, содержащий данные о товаре, и сохраняет его в свойстве _product.
- getProduct(): ICard — Возвращает объект типа ICard, содержащий все данные о товаре.
- getId(): string — Возвращает идентификатор товара.
- getImage(): string — Возвращает адрес изображения товара.
- getTitle(): string — Возвращает название товара.
- getCategory(): string — Возвращает категорию товара.
- getPrice(): number | null — Возвращает цену товара.
- getDescription(): string | undefined — Возвращает описание товара (может быть undefined, если описание отсутствует).

#### Класс BasketModel
Управляет корзиной: хранение товаров, подсчет суммы.
- items: ICard[] — массив объектов карточек, представляющих товары в корзине.
- totalPrice: number — общая сумма стоимости товаров в корзине.

Методы: 
- addItem(item: ICard): void — добавляет товар в корзину и обновляет общую сумму.
- removeItem(id: string): void — удаляет товар из корзины по его уникальному идентификатору и обновляет общую сумму.
- clear(): void — очищает корзину.
- getItems(): ICard[] — возвращает массив товаров в корзине.
- getTotalPrice(): number — возвращает общую сумму стоимости товаров в корзине (или 0, если корзина пуста).

#### Класс OrderModel
Класс OrderModel отвечает за хранение и валидацию данных заказа.
- data: Record<string, string> — Хранит данные заказа.
- errors: Record<string, string> — Хранит сообщения об ошибках валидации для полей ввода.

Методы:
- setData(inputData: Record<string, string>): void — Устанавливает данные заказа и производит валидацию.
- getErrors(): Record<string, string> — Возвращает объект с ошибками валидации.
- isValid(): boolean — Проверяет, все ли поля валидны.
- getData(): Record<string, string> — Возвращает объект с данными заказа.


### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс Page отвечает за отображение всей главной страницы. В его задачи входит управление контейнером для карточек, кнопкой корзины и счетчиком товаров.
- container: HTMLElement — контейнер для карточек товаров.
- cartButton: HTMLButtonElement — кнопка для открытия корзины.
- cartCounter: HTMLElement — элемент счётчика товаров в корзине.
- events: IEvents — брокер событий для взаимодействия с презентером.

Методы:
- constructor(container: HTMLElement, cartButton: HTMLButtonElement, cartCounter: HTMLElement, events: IEvents) — инициализация страницы.
- renderCards(cards: HTMLElement[]): void — рендерит массив карточек товаров.
- updateCartCounter(count: number): void — обновляет отображение счётчика корзины.
- addEventListeners(): void — навешивает обработчики событий (например, клик по кнопке корзины).

#### Класс ProductCard
Описывает карточку товара на главной странице. 
- cardData: ICard — Данные карточки товара, представляющие собой объект, содержащий информацию о товаре (ID, изображение, название, категория, цена и описание).
- cardElement: HTMLElement — HTML-элемент, представляющий карточку товара в DOM.

Методы:
- _createCardElement(): HTMLElement — Создаёт и возвращает HTML-элемент карточки товара с необходимой разметкой, включая изображение, название, описание, цену и кнопку "Купить".
- _addEventListeners(): void — Добавляет обработчики событий для кнопки "Купить" и самой карточки товара для обработки кликов.
- _buy(): void — Обрабатывает событие добавления товара в корзину. 
- getElement(): HTMLElement — Возвращает HTML-элемент карточки товара, который можно добавить в контейнер на странице.

#### Класс Modal
Класс Modal управляет отображением модального окна для различных типов контента, таких как информация о товаре и содержимое корзины.
- modal: HTMLElement — элемент модального окна, который идентифицируется по классу.
- events: IEvents — экземпляр класса EventEmitter для инициации событий при открытии, смене содержимого и закрытии окна.

Методы:
- open(contentType: 'product' | 'basket' | 'checkoutStep1' | 'checkoutStep2', card?: ICard): void — Открывает модальное окно для отображения содержимого. Если тип — "товар", карточка передается как параметр.
- close(): void — Закрывает модальное окно.
- updateContent(contentType: 'product' | 'basket' | 'checkoutStep1' | 'checkoutStep2', card?: ICard): void — Обновляет содержимое модального окна в зависимости от переданного типа и текущей карточки.
- addEventListeners(): void — Устанавливает слушатели событий для клавиатуры и кликов, чтобы управлять закрытием модального окна.

#### Класс ProductModal
Рендерит информацию о товаре в модальном окне.
- container: HTMLElement — контейнер содержимого модального окна (передаётся из класса Modal).
- events: IEvents — брокер событий для взаимодействия с презентером.

Методы:
- displayProduct(product: ICard): void — рендерит информацию о товаре (изображение, название, категория, цена, описание, кнопки действий).
- addEventListeners(): void — устанавливает слушатели событий для кнопок и других интерактивных элементов.

#### Класс BasketModal
Класс BasketModal отвечает за отображение содержимого корзины внутри общего модального окна.
- container: HTMLElement — контейнер содержимого модального окна (передаётся из класса Modal).
- events: IEvents — брокер событий для взаимодействия с презентером.

Методы:
- renderBasket(items: ICard[], total: number): void — отображает товары и итоговую сумму.
- addEventListeners(): void — устанавливает слушатели событий для кнопок, таких как "Далее" для перехода к оформлению и "Отменить" для закрытия окна.

#### Класс ModalContent
Класс ModalContent управляет содержимым, отображаемым в модальном окне. В зависимости от переданного типа контента, он отвечает за рендеринг информации о продукте или содержимого корзины.
- modal: HTMLElement — элемент модального окна, внутри которого происходит отображение содержимого.
- content: HTMLElement — элемент, в который будет отрисовываться конкретное содержимое (например, корзина или форма заказа).

Методы:
- renderContent(contentType: 'product' | 'basket' | 'checkoutStep1' | 'checkoutStep2', card?: ICard): void — Вызывает соответствующий метод отображения (displayProduct или displayBasket) в зависимости от переданного типа.
- displayProduct(card?: ICard): void — Логика для отображения информации о товаре.
- displayBasket(items: ICard[], total: number): void — Логика для отображения содержимого корзины.
- displayCheckoutStep1(): void — Логика для оформления заказа адрес.
- displayCheckoutStep2(): void — Логика для оформления заказа телефон и email.

#### Класс Form
Базовый класс, инкапсулирующий общую логику работы с формами.
- formEl: HTMLFormElement — DOM-элемент формы.
- inputs: NodeListOf<HTMLInputElement> — коллекция полей ввода.
- submitButton: HTMLButtonElement — кнопка подтверждения.
- errors: Record<string, HTMLElement> — элементы для вывода ошибок по name.
- formName: string — значение атрибута name формы.
- events: IEvents — брокер событий для общения с презентером.

Методы:
- _initErrors(): void — инициализация контейнеров ошибок.
- _initListeners(): void — навешивает обработчики input/submit и эмитит события (order:submit, order:input).
- setValid(isValid: boolean): void — включает/выключает кнопку подтверждения.
- setError(data: { field: string; value: string; validInformation: string }): void — устанавливает/убирает текст ошибки.
- showInputError (field: string, errorMessage: string): void — Отображает текст ошибки под указанным полем ввода.
- hideInputError (field: string): void — Очищает текст ошибки под указанным полем ввода.
- handleSubmit(): void — заглушка, переопределяется в наследниках (обычно просто эмит события).

#### Класс DeliveryForm (наследует Form)
Методы:
- handleSubmit(): void — эмитит checkout:step1Completed или form:validationError.

#### Класс ContactForm (наследует Form)
Отвечает за шаг 2 (почта и телефон).

Методы:
- handleSubmit(): void — эмитит checkout:step2Completed или form:validationError.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.


### Слой презентера

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События, связанные с карточками товаров*
- `cards:loaded` — когда карточки товаров успешно загружены с сервера.
- `card:selected` — при нажатии на карточку товара для отображения подробной информации.
- `card:added` — когда товар добавлен в корзину.
- `card:deleted` — при удалении товара из корзины.

*События, связанные с корзиной*
- `basket:opened` — при открытии модального окна корзины.
- `basket:closed` — при закрытии модального окна корзины.
- `checkout:started` — при нажатии на кнопку "Оформить заказ".

*События, связанные с оформлением заказа*
- `checkout:step1Completed` — после успешного заполнения формы оплаты и адреса доставки.
- `checkout:step2Completed` — после успешного ввода почты и телефона.
- `order:completed` — после успешного оформления заказа.

*События, связанные с пользовательским интерфейсом*
- `modal:opened` — при открытии модального окна.
- `modal:closed` — при закрытии модального окна.
- `navigation:backToProducts` — когда пользователь нажимает кнопку "Вернуться к списку товаров".

*События, связанные с ошибками и валидацией*
- `form:validationError` — когда происходит ошибка валидации формы.
- `form:validationSuccess` — когда все поля формы прошли валидацию.
