# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемы в приложении

Карточка

```
export interface ICard {
  _id: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  description?: string;
}
```

Структура, которая отвечает за множество карточек

```
export interface ICardData {
  cards: ICardsPreview[];
  preview: string | null;
}
```

Валидация форм

```
export interface IValidationForm {
  buttonError: boolean;
  addressError: string; 
  emailError: string; 
  phoneError: string; 
}
```

Корзина

```
export interface IBasket { 
  _id: string;
  total: number | null;
  items: ICard[];
}
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие


### Слой данных

#### Класс CardsData
Класс CardsData управляет карточками товаров как на главной странице, так и в корзине. Он включает в себя возможность отображения всех доступных карточек, добавления карточек в корзину, а так же предварительный просмотр и удаление из корзины.
- _cards: ICard[] - массив объектов карточек.
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- openCard(card: ICard): void; — Открытие карточек по клику.
- closeCard(card: ICard): void; — Закрытие карточки по нажатию на кнопку или на фон.
- getCard(cardID: string): ICard; — Получение список карточек.
- buyCard(card: ICard): void; — Добавляет карточку в корзину.
- deleteCard(cardID: string): void; — Удаляет карточку из корзины по ее ID, если нажать на кнопку добавления товара.
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс Basket
Класс Basket управляет корзиной для покупок, позволяя добавлять и удалять товары, очищать корзину и получать список карточек, содержащихся в ней.
- _id: string — уникальный идентификатор корзины.
- total: number | null — общая сумма стоимости всех товаров в корзине (может быть null, если корзина пуста).
- items: ICard[] — массив объектов карточек, представляющих товары, добавленные в корзину.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItem(card: ICard): void — Добавляет карточку в корзину. Обновляет общую сумму корзины.
- removeItem(cardId: string): void — Удаляет карточку из корзины по её уникальному идентификатору. Обновляет общую сумму корзины.
- clear(): void — Очищает корзину, удаляя все товары и сбрасывая общую сумму.
- getItems(): ICard[] — Возвращает массив карточек, находящихся в корзине.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Класс Modal реализует общее модальное окно, которое управляет отображением различных типов контента, таких как информация о товаре и содержимое корзины. Класс также отвечает за открытие и закрытие окна.
- modal: HTMLElement — элемент модального окна, который идентифицируется по классу.
- _isOpen: boolean — состояние модального окна (открыто или закрыто).
- _currentCard: ICard | null — текущая карточка товара, информация о которой отображается, когда открыт товар.
- events: IEvents — экземпляр класса EventEmitter для инициации событий при открытии, смене содержимого и закрытии окна.

Методы:
- constructor(selector: string, events: IEvents) — Конструктор принимает общий селектор для модального окна и экземпляр класса EventEmitter для инициации событий.
- open(contentType: 'product' | 'basket', card?: ICard): void — Открывает модальное окно для отображения товара или корзины. Если тип содержимого — товар, передается карточка.
- close(): void — Закрывает модальное окно.
- updateContent(contentType: 'product' | 'basket', card?: ICard): void — Обновляет содержимое модального окна в зависимости от переданного типа и текущей карточки.
- addEventListeners(): void — Устанавливает слушатели событий для клавиатуры и кликов, чтобы управлять закрытием модального окна.

#### Класс ModalContent
Класс ModalContent управляет содержимым, отображаемым в модальном окне. В зависимости от переданного типа контента, он отвечает за рендеринг информации о продукте или содержимого корзины.
- modal: HTMLElement — элемент модального окна, внутри которого происходит отображение содержимого.
- form: ModalForm — экземпляр класса, который управляет формой внутри модального окна.

Методы:
- renderContent(contentType: 'product' | 'basket', card?: ICard): void — Отображает соответствующее содержимое в зависимости от типа.
- displayProduct(card?: ICard): void — Логика для отображения информации о товаре.
- displayBasket(): void — Логика для отображения содержимого корзины.

#### Класс ModalForm
Класс ModalForm отвечает за логику взаимодействия с формой внутри модального окна. Он управляет полями ввода данных, кнопкой подтверждения и обработкой ошибок.
- modal: HTMLElement — элемент модального окна, где расположена форма.
- inputs: NodeListOf<HTMLInputElement> — коллекция всех полей ввода формы
- submitButton: HTMLButtonElement — кнопка подтверждения.
- errors: Record<string, HTMLElement> — объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.
- formName: string — значение атрибута name формы

Методы:
- getInputValues(): Record<string, string> — возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем.
- setValid(isValid: boolean): void — изменяет активность кнопки подтверждения.
- get form(): HTMLElement — геттер для получения элемента формы.
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода.

#### Класс ProductModal
Класс ProductModal будет отвечать за отображение карточек товаров и опять же позволит пользователям взаимодействовать с конкретным продуктом. Он управляет показом информации о товаре, включая его описание и покупки.
- modal: HTMLElement — элемент модального окна для отображения информации о товаре.
- _isOpen: boolean — состояние модального окна (открыто или закрыто).
- _currentCard: ICard | null — карточка товара, информация о которой отображается.

Методы:
- constructor(selector: string, events: IEvents) — принимает селектор модального окна и экземпляр EventEmitter.
- open(card: ICard): void — открывает модальное окно с информацией о продукте.
- close(): void — закрывает модальное окно.
- displayProduct(card: ICard): void — рендерит информацию о товаре.
- addEventListeners(): void — устанавливает слушатели событий для кнопок и других интерактивных элементов.

#### Класс BasketModal
Класс BasketModal отвечает за управление содержимым корзины и процессом оформления заказа. Он взаимодействует с пользователем, позволяя просматривать товары в корзине и переходить к этапу оформления.
- modal: HTMLElement — элемент модального окна для отображения содержимого корзины.
- _isOpen: boolean — состояние модального окна (открыто или закрыто).
- basket: Basket — экземпляр класса Basket, который содержит все товары в корзине.
- currentStep: 'basket' | 'checkout' — текущее состояние модального окна, определяющее, отображается ли корзина или форма оформления заказа.

Методы:
- constructor(selector: string, events: IEvents, basket: Basket) — принимает селектор модального окна, экземпляр EventEmitter и корзину.
- open(): void — открывает модальное окно с отображением содержимого корзины.
- close(): void — закрывает модальное окно.
- renderBasket(): void — отображает содержимое корзины с возможностью перейти к оформлению заказа.
- renderCheckout(): void — рендерит форму оформления заказа, позволяя пользователю вводить необходимые данные.
- addEventListeners(): void — устанавливает слушатели событий для кнопок, таких как "Далее" для перехода к оформлению и "Отменить" для закрытия окна.

#### Класс ProductCard
Класс ProductCard предназначен для создания и управления карточкой товара на главной странице магазина. Он позволяет отображать информацию о товаре, а также обрабатывать события, связанные с покупкой и открытием карточки. 
- cardData: ICard — Данные карточки товара, представляющие собой объект, содержащий информацию о товаре (ID, изображение, название, категория, цена и описание).
- cardElement: HTMLElement — HTML-элемент, представляющий карточку товара в DOM.

Методы:
- constructor(card: ICard) — Конструктор класса. Инициализирует данные карточки товара и создаёт DOM-элемент для её отображения. Добавляет обработчики событий для взаимодействия с карточкой.
- _createCardElement(): HTMLElement — Создаёт и возвращает HTML-элемент карточки товара с необходимой разметкой, включая изображение, название, описание, цену и кнопку "Купить".
- open(): void — Открывает карточку товара, выводя информацию о товаре в модальном окне (при необходимости).
- _addEventListeners(): void — Добавляет обработчики событий для кнопки "Купить" и самой карточки товара для обработки кликов.
- _buy(): void — Обрабатывает событие добавления товара в корзину. 
- getElement(): HTMLElement — Возвращает HTML-элемент карточки товара, который можно добавить в контейнер на странице.

#### Класс ProductCardsContainer
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События, связанные с карточками товаров*
- `cards:loaded` — когда карточки товаров успешно загружены с сервера.
- `card:selected` — при нажатии на карточку товара для отображения подробной информации.
- `card:added` — когда товар добавлен в корзину.
- `card:deleted` — при удалении товара из корзины.

*События, связанные с корзиной*
- `basket:opened` — при открытии модального окна корзины.
- `basket:closed` — при закрытии модального окна корзины.
- `checkout:started` — при нажатии на кнопку "Оформить заказ".

*События, связанные с оформлением заказа*
- `payment:methodSelected` — после выбора способа оплаты.
- `order:formSubmitted` — при подтверждении формы оформления заказа (ввод адреса).
- `order:completed` — после успешного оформления заказа.

*События, связанные с пользовательским интерфейсом*
- `modal:opened` — при открытии модального окна.
- `modal:closed` — при закрытии модального окна.
- `navigation:backToProducts` — когда пользователь нажимает кнопку "Вернуться к списку товаров".

*События, связанные с ошибками и валидацией*
- `form:validationError` — когда происходит ошибка валидации формы.
- `form:validationSuccess` — когда все поля формы прошли валидацию.
